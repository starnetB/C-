<!DOCTYPE html>
<!-- saved from url=(0049)https://www.cnblogs.com/sunsky303/p/16497592.html -->
<html lang="zh-cn" style="--olcb-folder-code-block-max-height:80vh;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="never">
    <meta name="description" content="前言 在现代 c + + 编程中，标准库包含 智能指针，这些指针用于帮助确保程序不会出现内存和资源泄漏，并具有异常安全。 标准库智能指针分类 auto_ptr, shared_ptr, weak_pt">
    <meta property="og:description" content="前言 在现代 c + + 编程中，标准库包含 智能指针，这些指针用于帮助确保程序不会出现内存和资源泄漏，并具有异常安全。 标准库智能指针分类 auto_ptr, shared_ptr, weak_pt">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>彻底搞懂之C++智能指针 - sunsky303 - 博客园</title>
    <link id="favicon" rel="shortcut icon" href="https://common.cnblogs.com/favicon.svg" type="image/svg+xml">
    
    <style>#home :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs), :not(.cnblogs_code):not(.cnblogs_Highlighter)>pre:not([highlighted]):not([class*="brush:"]) code:not(.hljs) {background: rgb(248, 248, 248);
        padding: 13px;
        border: 0px none rgb(51, 51, 51);
        border-radius: 0px;
        border-color: transparent;
        color: rgb(51, 51, 51);
        font-family: monospace;
        font-size: 13px</style><link rel="stylesheet" href="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/blog-common.min.css">
    
        <link id="highlighter-theme-github" type="text/css" rel="stylesheet" href="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/github.css">
    <link type="text/css" rel="stylesheet" href="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/custom.css">
    <link id="mobile-style" media="only screen and (max-width: 767px)" type="text/css" rel="stylesheet" href="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/mobile-common.min.css">
    
    <link type="application/rss+xml" rel="alternate" href="https://www.cnblogs.com/sunsky303/rss">
    <link type="application/rsd+xml" rel="EditURI" href="https://www.cnblogs.com/sunsky303/rsd.xml">
    <link type="application/wlwmanifest+xml" rel="wlwmanifest" href="https://www.cnblogs.com/sunsky303/wlwmanifest.xml">
    <script type="text/javascript" async="" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/analytics.js"></script><script>
        var currentBlogId = 120626;
        var currentBlogApp = 'sunsky303';
        var isLogined = false;
        var isBlogOwner = false;
        var skinName = 'MoonlightInk';
        var visitorUserId = '';
        var hasCustomScript = true;
        try {
            if (hasCustomScript && document.referrer && document.referrer.indexOf('baidu.com') >= 0) {
                Object.defineProperty(document, 'referrer', { value: '' });
                Object.defineProperty(Document.prototype, 'referrer', { get: function(){ return ''; } });
            }
        } catch(error) { }
        window.cb_enable_mathjax = true;
        window.mathEngine = 1;
        window.codeHighlightEngine = 1;
        window.enableCodeLineNumber = false;
        window.codeHighlightTheme = 'github';
        window.darkModeCodeHighlightTheme = 'vs2015';
        window.isDarkCodeHighlightTheme = false;
        window.isDarkModeCodeHighlightThemeDark = true;
        window.isDisableCodeHighlighter = false;
        window.enableCodeThemeTypeFollowSystem = false;
    </script>
        <script>
            var currentPostDateAdded = '2022-07-20 14:24';
        </script>
    <script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/jquery-2.2.0.min.js"></script>
    <script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/blog-common.min.js"></script><style>.medium-zoom-overlay {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  opacity: 0;
  transition: opacity 300ms;
  will-change: opacity;
}

.medium-zoom--opened .medium-zoom-overlay {
  cursor: pointer;
  cursor: zoom-out;
  opacity: 1;
}

.medium-zoom-image {
  cursor: pointer;
  cursor: zoom-in;
  /*
    The `transition` is marked as "!important" for the animation to happen
    even though it's overriden by another inline `transition` style attribute.

    This is problematic with frameworks that generate inline styles on their
    images (e.g. Gatsby).

    See https://github.com/francoischalifour/medium-zoom/issues/110
   */
  transition: transform 300ms cubic-bezier(0.2, 0, 0.2, 1) !important;
}

.medium-zoom-image--hidden {
  visibility: hidden;
}

.medium-zoom-image--opened {
  position: relative;
  cursor: pointer;
  cursor: zoom-out;
  will-change: transform;
}
</style><script id="hljs-script" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/highlight.min.js" type="text/javascript" async=""></script><script id="mathjax" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/tex-mml-chtml.js" async=""></script>
    
<script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/noerrors.js" charset="UTF-8"></script><script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/extpfeil.js" charset="UTF-8"></script><meta http-equiv="origin-trial" content="A+cA2PUOfIOKAdSDJOW5CP9ZlxONy1yu+hqAq72zUtKw4rLdihqRp6Nui/jUyCyegr+BUtH+C+Elv0ufn05yBQEAAACFeyJvcmlnaW4iOiJodHRwczovL2RvdWJsZWNsaWNrLm5ldDo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="A+zsdH3aNZT/bkjT8U/o5ACzyaeNYzTvtoVmwf/KOilfv39pxY2AIsOwhQJv+YnXp98i3TqrQibIVtMWs5UHjgoAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXN5bmRpY2F0aW9uLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><meta http-equiv="origin-trial" content="AxceVEhIegcDEHqLXFQ2+vPKqzCppoJYsRCZ/BdfVnbM/sUUF2BXV8lwNosyYjvoxnTh2FC8cOlAnA5uULr/zAUAAACLeyJvcmlnaW4iOiJodHRwczovL2dvb2dsZXRhZ3NlcnZpY2VzLmNvbTo0NDMiLCJmZWF0dXJlIjoiUHJpdmFjeVNhbmRib3hBZHNBUElzIiwiZXhwaXJ5IjoxNjY5NzY2Mzk5LCJpc1N1YmRvbWFpbiI6dHJ1ZSwiaXNUaGlyZFBhcnR5Ijp0cnVlfQ=="><script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/pubads_impl_2022081701.js" async=""></script><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style><style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://mathjax.cnblogs.com/3_2_1/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}
</style><link rel="preload" href="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/f.txt" as="script"><script type="text/javascript" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/f.txt"></script><link rel="preload" href="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/f(1).txt" as="script"><script type="text/javascript" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/f(1).txt"></script></head>
<body class="skin-moonlightink no-navbar mathjax3 hljs-engine">
<a name="top"></a>
<div id="top_nav" class="navbar forpc navbar-custom">
    <nav id="nav_main" class="navbar-main">
        <ul id="nav_left" class="navbar-list navbar-left">
            <li class="navbar-branding">
                <a href="https://www.cnblogs.com/" title="开发者的网上家园" role="banner">
                    <img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/logo.svg" alt="博客园Logo">
                </a>
            </li>
            <li>
                <a href="https://www.cnblogs.com/" onclick="countClicks(&#39;skin-navbar-sitehome&#39;)">首页</a>
            </li>
            <li>
                <a href="https://news.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-news&#39;)">新闻</a>
            </li>
            <li>
                <a href="https://q.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-q&#39;)">博问</a>
            </li>
            <li>
                <a id="nav_brandzone" href="https://brands.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-brands&#39;)">专区</a>
            </li>
            <li>
                <a href="https://ing.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-ing&#39;)">闪存</a>
            </li>
            <li>
                <a href="https://edu.cnblogs.com/" onclick="countClicks(&#39;nav&#39;, &#39;skin-navbar-edu&#39;)">班级</a>
            </li>
        </ul>
        <ul id="nav_right" class="navbar-list navbar-right">
            <li>
                <form id="zzk_search" class="navbar-search" action="https://zzk.cnblogs.com/s" method="get" role="search">
                    <input name="w" id="zzk_search_input" placeholder="代码改变世界" type="search" tabindex="3">
                    <button type="submit" id="zzk_search_button">
                        <img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/search.svg" alt="搜索">
                    </button>
                </form>
            </li>
            <li id="navbar_login_status" class="navbar-list">
                <a class="navbar-user-info navbar-blog" href="https://i.cnblogs.com/EditPosts.aspx?opt=1" alt="写随笔" title="写随笔">
                    <img id="new_post_icon" class="navbar-icon" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/newpost.svg" alt="写随笔">
                </a>
                <a id="navblog-myblog-icon" class="navbar-user-info navbar-blog" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx" alt="我的博客" title="我的博客">
                    <img id="myblog_icon" class="navbar-icon" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/myblog.svg" alt="我的博客">
                </a>
                <a class="navbar-user-info navbar-message navbar-icon-wrapper" href="https://msg.cnblogs.com/" alt="短消息" title="短消息">
                    <img id="msg_icon" class="navbar-icon" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/message.svg" alt="短消息">
                    <span id="msg_count" style="display: none"></span>
                </a>
                <a id="navbar_lite_mode_indicator" data-current-page="blog" style="display: none" href="javascript:void(0)" alt="简洁模式" title="简洁模式启用，您在访问他人博客时会使用简洁款皮肤展示">
                    <img class="navbar-icon" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/lite-mode-on.svg" alt="简洁模式">
                </a>
                <div id="user_info" class="navbar-user-info dropdown">
                    <a class="dropdown-button" href="https://home.cnblogs.com/">
                        <img id="user_icon" class="navbar-avatar" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/avatar-default.svg" alt="用户头像">
                    </a>
                    <div class="dropdown-menu">
                        <a id="navblog-myblog-text" href="https://passport.cnblogs.com/GetBlogApplyStatus.aspx">我的博客</a>
                        <a href="https://home.cnblogs.com/">我的园子</a>
                        <a href="https://account.cnblogs.com/settings/account">账号设置</a>
                        <a href="javascript:void(0)" id="navbar_lite_mode_toggle" title="简洁模式会使用简洁款皮肤显示所有博客">
    简洁模式 <img id="navbar_lite_mode_on" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/lite-mode-check.svg" class="hide"><span id="navbar_lite_mode_spinner" class="hide">...</span>
</a>
                        <a href="javascript:void(0)" onclick="account.logout();">退出登录</a>
                    </div>
                </div>
                <a class="navbar-anonymous" href="https://account.cnblogs.com/signup">注册</a>
                <a class="navbar-anonymous" href="javascript:void(0);" onclick="account.login()">登录</a>
            </li>
        </ul>
    </nav>
</div>



<!--done-->
<div id="home">
<div id="header">
	<div id="blogTitle">
        <a id="lnkBlogLogo" href="https://www.cnblogs.com/sunsky303/"><img id="blogLogo" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/logo.gif" alt="返回主页"></a>		
		
<!--done-->
<h1><a id="Header1_HeaderTitle" class="headermaintitle HeaderMainTitle" href="https://www.cnblogs.com/sunsky303/">健 の 随笔</a>
</h1>
<h2>工作、生活、理想的记录和思考</h2>




		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li><a id="blog_nav_sitehome" class="menu" href="https://www.cnblogs.com/">
博客园</a>
</li>
<li>
<a id="blog_nav_myhome" class="menu" href="https://www.cnblogs.com/sunsky303/">
首页</a>
</li>
<li>

<a id="blog_nav_newpost" class="menu" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">
新随笔</a>
</li>
<li>
<a id="blog_nav_contact" class="menu" href="https://msg.cnblogs.com/send/sunsky303">
联系</a></li>
<li>
<a id="blog_nav_rss" class="menu" href="javascript:void(0)" data-rss="https://www.cnblogs.com/sunsky303/rss/">
订阅</a>
<!--<partial name="./Shared/_XmlLink.cshtml" model="Model" /></li>--></li>
<li>
<a id="blog_nav_admin" class="menu" href="https://i.cnblogs.com/">
管理</a>
</li>
</ul>


		<div class="blogStats">
			<span id="stats_post_count">随笔 - 452&nbsp; </span>
<span id="stats_article_count">文章 - 1&nbsp; </span>
<span id="stats-comment_count">评论 - 107&nbsp; </span>
<span id="stats-total-view-count">阅读 - 
<span title="总阅读数: 1773532">
177万</span></span>

		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		<div id="post_detail">
    <!--done-->
    <div id="topics">
        <div class="post">
            <h1 class="postTitle">
                
<a id="cb_post_title_url" class="postTitle2 vertical-middle" href="https://www.cnblogs.com/sunsky303/p/16497592.html">
    <span role="heading" aria-level="2">彻底搞懂之C++智能指针</span>
    
</a><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button>

            </h1>
            <div class="clear"></div>
            <div class="postBody">
                <div id="cnblogs_post_body" class="blogpost-body blogpost-body-html">
<p><span style="font-family: &quot;PingFang SC&quot;, &quot;Smart Quotes&quot;, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px"><img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/420532-20220720095122706-149653483.png" alt="" height="798" width="710" data-action="zoom" class="medium-zoom-image"></span></p>
<p id="1658296992483"></p>
<p id="1658281911421"></p>
<p id="1658281899056"></p>
<p id="1658281884769"></p>
<h2 id="blogTitle0"><span style="font-family: &quot;PingFang SC&quot;, &quot;Smart Quotes&quot;, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px">前言</span><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p id="smart-pointers-modern-c"><span style="font-family: &quot;PingFang SC&quot;, &quot;Smart Quotes&quot;, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px">在现代 c + + 编程中，标准库包含 </span><em style="font-family: &quot;PingFang SC&quot;, &quot;Smart Quotes&quot;, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px">智能指针</em><span style="font-family: &quot;PingFang SC&quot;, &quot;Smart Quotes&quot;, -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif; font-size: 14px">，这些指针用于帮助确保程序不会出现内存和资源泄漏，并具有异常安全。</span></p>
<p>&nbsp;</p>
<h2 id="blogTitle1"><span style="font-size: 14px">标准库智能指针分类</span><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>auto_ptr, shared_ptr, weak_ptr, unique_ptr 其中后三个是c++11支持，并且第一个已经被c++11弃用。所以我只说后3个。</p>
<ol>
<li><strong>shared_ptr</strong><br>采用引用计数的智能指针。 如果你想要将一个原始指针分配给多个所有者（例如，从容器返回了指针副本又想保留原始指针时），请使用该指针。 直至所有 shared_ptr 所有者超出了范围或放弃所有权，才会删除原始指针。 大小为两个指针；一个用于对象，另一个用于包含引用计数的共享控制块。 头文件：&lt;memory&gt;。 有关详细信息，请参阅 如何：创建和使用 Shared_ptr 实例 和 shared_ptr 类。</li>
<li><strong>unique_ptr</strong><br>只允许基础指针的一个所有者。 除非你确信需要 shared_ptr，否则请将该指针用作 POCO 的默认选项。 可以移到新所有者，但不会复制或共享。 替换已弃用的 auto_ptr。 与 boost::scoped_ptr 比较。 unique_ptr 很小且高效;大小是一个指针，它支持用于从 c + + 标准库集合快速插入和检索的右值引用。 头文件：&lt;memory&gt;。 有关详细信息，请参阅 如何：创建和使用 Unique_ptr 实例 和 unique_ptr 类。</li>
<li><strong>weak_ptr</strong><br>结合 shared_ptr 使用的特例智能指针。 weak_ptr 提供对一个或多个 shared_ptr 实例拥有的对象的访问，但不参与引用计数。 如果你想要观察某个对象但不需要其保持活动状态，请使用该实例。 在某些情况下，需要断开 shared_ptr 实例间的循环引用。 头文件：&lt;memory&gt;。 有关详细信息，请参阅 如何：创建和使用 Weak_ptr 实例 和 weak_ptr 类。</li>
</ol>
<p>&nbsp;</p>
<h2 id="blogTitle2">shared_ptr<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>shared_ptr 类型是 C++ 标准库中的一个智能指针，是为多个所有者可能必须管理对象在内存中的生命周期的方案设计的。 在您初始化一个 shared_ptr 之后，您可复制它，按值将其传入函数参数，然后将其分配给其他 shared_ptr 实例。 所有实例均指向同一个对象，并共享对一个“控制块”（每当新的 shared_ptr 添加、超出范围或重置时增加和减少引用计数）的访问权限。 当引用计数达到零时，控制块将删除内存资源和自身。</p>
<p>下图显示了指向一个内存位置的几个&nbsp;<code>shared_ptr</code>&nbsp;实例。</p>
<p><img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/shared_ptr.png" alt="Shared pointer diagram." data-linktype="relative-path" data-action="zoom" class="medium-zoom-image"></p>
<p>&nbsp;原始用法：</p>
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs">Object * obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ChildObject</span>(<span class="hljs-number">9</span>);<span class="hljs-comment">//从heap分配原始父对象，必须手动触发析构, 但子对象不会释放</span>
<span class="hljs-built_in">testObject</span>(*obj);
<span class="hljs-built_in">printf</span>(<span class="hljs-string">"release9 %p \n"</span>, obj);
<span class="hljs-keyword">delete</span> obj;</code></pre>
<p>当testObject()出现异常时，delete将不被执行，因此将导致内存泄露。</p>
<p>如何避免这种问题？有人会说，这还不简单，直接在<code>throw exception(); 在catch中</code>加上<code>delete ps;</code>不就行了。问题是很多人都会忘记在适当的地方加上delete语句，如果你要对一个庞大的工程进行review，看是否有这种潜在的内存泄露问题，那就是一场灾难！<br>这时我们会想：<strong>如果指向heap的内存也能像stack变量一样用完时被自动释放，那该有多好啊。</strong></p>
<p>这正是 auto_ptr、unique_ptr和shared_ptr这几个智能指针背后的设计思想。我简单的总结下就是：<strong>将基本类型指针封装为类对象指针（这个类肯定是个模板，以适应不同基本类型的需求），并在析构函数里编写delete语句删除指针指向的内存空间。</strong></p>
<p>&nbsp;</p>
<p><strong>使用shared_ptr：</strong></p>
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs">{
    std::shared_ptr&lt;Object&gt; sObj = std::<span class="hljs-built_in">make_shared</span>&lt;ChildObject&gt;(<span class="hljs-number">1</span>);
    <span class="hljs-built_in">testObject</span>(*sObj); <span class="hljs-comment">//调用父对象</span>
    <span class="hljs-comment">//自动回收 </span>
}</code></pre>
<p>很简单对吧~</p>
<p>&nbsp;</p>
<h2 id="blogTitle3"><strong>unique_ptr</strong><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>unique_ptr不共享指针。 它不能复制到另一个 unique_ptr函数，由值传递给函数，或在任何需要复制副本的 C++ 标准库算法中使用。 只能移动 unique_ptr。 这意味着，内存资源所有权将转移到另一 unique_ptr，并且原始 unique_ptr 不再拥有此资源。 我们建议你将对象限制为由一个所有者所有，因为多个所有权会使程序逻辑变得复杂。 因此，当需要纯 C++ 对象的智能指针时，请使用make_unique帮助程序函数。</p>
<p>下图演示了两个&nbsp;<code>unique_ptr</code>&nbsp;实例之间的所有权转换。</p>
<p><img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/unique_ptr.png" alt="Diagram that shows moving the ownership of a unique pointer." data-linktype="relative-path" data-action="zoom" class="medium-zoom-image"></p>
<p><code>unique_ptr</code>&nbsp;在 C++ 标准库的标头中&nbsp;<code>&lt;memory&gt;</code>&nbsp;定义。 它与原始指针一样高效，可在 C++ 标准库容器中使用。 将实例添加到&nbsp;<code>unique_ptr</code>&nbsp;C++ 标准库容器是有效的，因为移动构造函数&nbsp;<code>unique_ptr</code>&nbsp;无需复制操作。</p>
<p>unique_ptr 是一个独享所有权的智能指针，它提供了严格意义上的所有权，包括：</p>
<p>1、拥有它指向的对象</p>
<p>2、无法进行复制构造，无法进行复制赋值操作。即无法使两个unique_ptr指向同一个对象。但是可以进行移动构造和移动赋值操作</p>
<p>3、保存指向某个对象的指针，当它本身被删除释放的时候，会使用给定的删除器释放它指向的对象</p>
<p>&nbsp;</p>
<p>用法：</p>
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs">std::unique_ptr&lt;<span class="hljs-type">int</span>&gt;<span class="hljs-built_in">p1</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">5</span>));
std::unique_ptr&lt;<span class="hljs-type">int</span>&gt;p2=p1;<span class="hljs-comment">// 编译会出错</span>
std::unique_ptr&lt;<span class="hljs-type">int</span>&gt;p3=std::<span class="hljs-built_in">move</span>(p1);<span class="hljs-comment">// 转移所有权,那块内存归p3所有, p1成为无效的针.</span>
p3.<span class="hljs-built_in">reset</span>();<span class="hljs-comment">//释放内存.</span>
p1.<span class="hljs-built_in">reset</span>();<span class="hljs-comment">//无效</span></code></pre>
<p>&nbsp;</p>
<p>share_ptr和unique_ptr的例子：</p>
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;

<span class="hljs-keyword">namespace</span> Test
{
    <span class="hljs-meta">#<span class="hljs-keyword">define</span> formatBool(b) ((b) ? <span class="hljs-string">"true"</span> : <span class="hljs-string">"false"</span>)</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Object</span>
    {
    <span class="hljs-keyword">protected</span>:
        <span class="hljs-type">int</span> id;

    <span class="hljs-keyword">public</span>:
        <span class="hljs-keyword">using</span> pointer = std::shared_ptr&lt;Object&gt;;
        <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">version</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"1.0.0"</span>;
        }; 
        <span class="hljs-built_in">Object</span>(<span class="hljs-type">int</span> _id):<span class="hljs-built_in">id</span>(_id){
            cout &lt;&lt; <span class="hljs-string">"\nnew parent Object id:"</span> &lt;&lt; id  &lt;&lt; endl;
        };
        <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Object</span>(){<span class="hljs-comment">//释放时，首先是派生，然后是基类。必须将基类析构函数设为虚基类， 防止delete 子对象时不会调用父析构函数，导致内存泄露</span>
            <span class="hljs-keyword">delete</span> parent_str_ptr;
            cout &lt;&lt; <span class="hljs-string">"delete parent Object id:"</span> &lt;&lt; id  &lt;&lt; endl;
        };
        <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">debug</span><span class="hljs-params">()</span> <span class="hljs-type">const</span>
        </span>{
            <span class="hljs-keyword">auto</span> str = std::<span class="hljs-built_in">string</span>( <span class="hljs-string">"debug Object id:"</span> + std::<span class="hljs-built_in">to_string</span>(id) );
            <span class="hljs-keyword">return</span> str;
        }

    <span class="hljs-keyword">private</span>:
        std::string *parent_str_ptr = <span class="hljs-keyword">new</span> std::<span class="hljs-built_in">string</span>(<span class="hljs-string">"parent_str_ptr memory leak"</span>);                                          
    };
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">ChildObject</span> : <span class="hljs-keyword">public</span> Object
    {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">ChildObject</span>(<span class="hljs-type">int</span> _id):<span class="hljs-built_in">Object</span>(_id)
        {
            std::cout &lt;&lt; <span class="hljs-string">"new ChildObject id:"</span> &lt;&lt; (id) &lt;&lt; <span class="hljs-string">"\n"</span>;
        }

        ~<span class="hljs-built_in">ChildObject</span>()
        {
            <span class="hljs-keyword">delete</span> str_ptr;
            std::cout &lt;&lt; <span class="hljs-string">"delete ChildObject id:"</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">"\n"</span>;
        }
        <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::string <span class="hljs-title">version</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"2.0.0"</span>;
        }; 
    <span class="hljs-keyword">private</span>:
        std::string *str_ptr = <span class="hljs-keyword">new</span> std::<span class="hljs-built_in">string</span>(<span class="hljs-string">"memory leak"</span>);  

    };

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">testObject</span><span class="hljs-params">(<span class="hljs-type">const</span> Object &amp;obj)</span>
    </span>{
        std::cout &lt;&lt; obj.<span class="hljs-built_in">debug</span>() &lt;&lt; <span class="hljs-string">" version:"</span>&lt;&lt; obj.<span class="hljs-built_in">version</span>() &lt;&lt; <span class="hljs-string">"\n"</span>;
    }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">testCase</span><span class="hljs-params">()</span>
    </span>{
        {
            std::shared_ptr&lt;Object&gt; sObj = std::<span class="hljs-built_in">make_shared</span>&lt;ChildObject&gt;(<span class="hljs-number">1</span>);
            <span class="hljs-built_in">testObject</span>(*sObj); <span class="hljs-comment">//调用父对象</span>
            <span class="hljs-comment">//自动回收 </span>
        }

        {
            std::unique_ptr&lt;Object&gt; obj = std::<span class="hljs-built_in">make_unique</span>&lt;ChildObject&gt;(<span class="hljs-number">2</span>);
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-keyword">auto</span> obj2 = std::<span class="hljs-built_in">move</span>(obj);<span class="hljs-comment">//转移所有权到obj2</span>

            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"obj:%s obj2:%s \n"</span>, formatBool(!!obj), formatBool(!!obj2));

            <span class="hljs-built_in">testObject</span>(*obj2);<span class="hljs-comment">//调用父对象</span>

            obj2.<span class="hljs-built_in">release</span>();<span class="hljs-comment">//手动释放后， obj, obj2指向的对象已经被回收， 不会触发自动回收</span>
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"obj2.release， obj:%s obj2:%s \n"</span>, formatBool(!!obj), formatBool(!!obj2));
        }

        {
            std::unique_ptr&lt;ChildObject&gt; obj = std::<span class="hljs-built_in">make_unique</span>&lt;ChildObject&gt;(<span class="hljs-number">3</span>);<span class="hljs-comment">// 使用make_unique</span>
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release3 %s \n"</span>, formatBool(!!obj));
        }
        {
            <span class="hljs-function">std::unique_ptr&lt;ChildObject&gt; <span class="hljs-title">obj</span><span class="hljs-params">(<span class="hljs-keyword">new</span> ChildObject(<span class="hljs-number">4</span>))</span></span>;<span class="hljs-comment">//使用new</span>
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release4 %s \n"</span>, formatBool(!!obj));
        }
        {
            <span class="hljs-comment">// std::unique_ptr&lt;ChildObject&gt; obj(ChildObject(5));//使用stack对象，这是错误的用法， error: no matching constructor for initialization of 'std::unique_ptr&lt;Object&gt;'</span>
            <span class="hljs-comment">// printf("release5 %d \n", !!obj);</span>
        }
        {
            std::unique_ptr&lt;Object&gt; obj = std::<span class="hljs-built_in">make_unique</span>&lt;ChildObject&gt;(<span class="hljs-number">6</span>);<span class="hljs-comment">//用父对象, 会触发析构</span>
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release6 %s \n"</span>, formatBool(!!obj));
        }
        {
            ChildObject obj = <span class="hljs-built_in">ChildObject</span>(<span class="hljs-number">7</span>);<span class="hljs-comment">//从stack分配原始对象， 会触发析构</span>
            <span class="hljs-built_in">testObject</span>(obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release7 %p \n"</span>, &amp;obj);
        }
        {
            ChildObject * obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ChildObject</span>(<span class="hljs-number">8</span>);<span class="hljs-comment">//从heap分配原始对象， 必须手动触发析构</span>
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release8 %p \n"</span>, obj);
            <span class="hljs-keyword">delete</span> obj;
        }
        {
            Object * obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ChildObject</span>(<span class="hljs-number">9</span>);<span class="hljs-comment">//从heap分配原始父对象，必须手动触发析构</span>
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release9 %p \n"</span>, obj);
            <span class="hljs-keyword">delete</span> obj;
        }
        {
            Object * obj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Object</span>(<span class="hljs-number">10</span>);<span class="hljs-comment">//从heap分配原始父对象，必须手动触发析构</span>
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release10 %p \n"</span>, obj);
            <span class="hljs-keyword">delete</span> obj;
        }
        {
            std::shared_ptr&lt;Object&gt; obj = std::<span class="hljs-built_in">make_unique</span>&lt;ChildObject&gt;(<span class="hljs-number">11</span>);<span class="hljs-comment">//指向父对象, 会释放子对象</span>
            <span class="hljs-built_in">testObject</span>(*obj);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"release11 %s \n"</span>, formatBool(!!obj));
        }
        <span class="hljs-comment">// {</span>
        <span class="hljs-comment">//     std::unique_ptr&lt;Object&gt; obj = std::make_shared&lt;ChildObject&gt;(11);//error: no viable conversion from 'shared_ptr&lt;Test::ChildObject&gt;' to 'std::unique_ptr&lt;Object&gt;'</span>
        <span class="hljs-comment">//     testObject(*obj);</span>
        <span class="hljs-comment">//     printf("release11 %s \n", formatBool(!!obj));</span>
        <span class="hljs-comment">// }</span>
    }
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> **argv)</span>
</span>{
    Test::<span class="hljs-built_in">testCase</span>();

    <span class="hljs-keyword">return</span> EXIT_SUCCESS;
}</code></pre>
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-meta">#  c++ -std=c++14 -o a share_ptr.cpp; ./a</span>
<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">1</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">1</span>
debug Object id:<span class="hljs-number">1</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">1</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">1</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">2</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">2</span>
debug Object id:<span class="hljs-number">2</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
obj:<span class="hljs-literal">false</span> obj2:<span class="hljs-literal">true</span> 
debug Object id:<span class="hljs-number">2</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
obj2.release， obj:<span class="hljs-literal">false</span> obj2:<span class="hljs-literal">false</span> 

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">3</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">3</span>
debug Object id:<span class="hljs-number">3</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
release3 <span class="hljs-literal">true</span> 
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">3</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">3</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">4</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">4</span>
debug Object id:<span class="hljs-number">4</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
release4 <span class="hljs-literal">true</span> 
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">4</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">4</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">6</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">6</span>
debug Object id:<span class="hljs-number">6</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
release6 <span class="hljs-literal">true</span> 
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">6</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">6</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">7</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">7</span>
debug Object id:<span class="hljs-number">7</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
release7 <span class="hljs-number">0x7ff7bfcf3488</span> 
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">7</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">7</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">8</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">8</span>
debug Object id:<span class="hljs-number">8</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
release8 <span class="hljs-number">0x7fcaef705ba0</span> 
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">8</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">8</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">9</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">9</span>
debug Object id:<span class="hljs-number">9</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
release9 <span class="hljs-number">0x7fcaef705ba0</span> 
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">9</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">9</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">10</span>
debug Object id:<span class="hljs-number">10</span> version:<span class="hljs-number">1.0</span><span class="hljs-number">.0</span>
release10 <span class="hljs-number">0x7fcaef705ba0</span> 
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">10</span>

<span class="hljs-keyword">new</span> parent Object id:<span class="hljs-number">11</span>
<span class="hljs-keyword">new</span> ChildObject id:<span class="hljs-number">11</span>
debug Object id:<span class="hljs-number">11</span> version:<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>
release11 <span class="hljs-literal">true</span> 
<span class="hljs-keyword">delete</span> ChildObject id:<span class="hljs-number">11</span>
<span class="hljs-keyword">delete</span> parent Object id:<span class="hljs-number">11</span></code></pre>
<h2 id="blogTitle4"><strong>weak_ptr</strong><button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>weak_ptr是用来<strong>解决shared_ptr相互引用时的死锁问题,</strong>如果说两个shared_ptr相互引用,那么这两个指针的引用计数永远不可能下降为0,资源永远不会释放。它是对对象的一种弱引用，不会增加对象的引用计数，和shared_ptr之间可以相互转化，shared_ptr可以直接赋值给它，它可以通过调用lock函数来获得shared_ptr。</p>
<p>最佳设计是避免在任何时候都能实现指针的共享所有权。 但是，如果您必须有实例的&nbsp;<code>shared_ptr</code>&nbsp;共享所有权，请避免它们之间存在循环引用。 如果无法避免循环引用，或者出于某种原因更可取，则使用&nbsp;<a href="https://docs.microsoft.com/zh-cn/cpp/standard-library/weak-ptr-class?view=msvc-170" data-linktype="relative-path" rel="noopener">weak_ptr</a>&nbsp;向一个或多个所有者提供对另&nbsp;<code>shared_ptr</code>&nbsp;一个的弱引用。 通过使用&nbsp;<code>weak_ptr</code>&nbsp;，可以创建一个&nbsp;<code>shared_ptr</code>&nbsp;联接到一组现有相关实例的，但前提是基础内存资源仍有效。&nbsp;<code>weak_ptr</code>本身并不参与引用计数，因此它无法阻止引用计数转到零。 但是，你可以使用&nbsp;<code>weak_ptr</code>&nbsp;来尝试获取用于初始化的的新副本&nbsp;<code>shared_ptr</code>&nbsp;。 如果已删除内存，则的 bool 运算符将&nbsp;<code>weak_ptr</code>&nbsp;返回&nbsp;<strong><code>false</code></strong>&nbsp;。 如果内存仍有效，新的共享指针会递增引用计数，并保证只要&nbsp;<code>shared_ptr</code>&nbsp;变量保持在范围内，内存就有效。weak_ptr是弱智能指针对象，它不控制所指向对象生存期的智能指针，它指向由一个shared_ptr管理的智能指针。将一个weak_ptr绑定到一个shared_ptr对象，不会改变shared_ptr的引用计数。一旦最后一个所指向对象的shared_ptr被销毁，所指向的对象就会被释放，即使此时有weak_ptr指向该对象，所指向的对象依然被释放。<br><br></p>
<p>例子：</p>
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span>
{
<span class="hljs-keyword">public</span>:
    ~<span class="hljs-built_in">B</span>()
    {
        std::cout &lt;&lt; <span class="hljs-string">"B destory, a_ptr use_count:"</span> &lt;&lt; a_ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; <span class="hljs-string">"\n"</span>;
    }

    <span class="hljs-comment">//    std::shared_ptr&lt;A&gt; a_ptr; //它会造成循环引用</span>
    std::weak_ptr&lt;A&gt; a_ptr;<span class="hljs-comment">//它不会循环引用</span>
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span>
{
<span class="hljs-keyword">public</span>:
    ~<span class="hljs-built_in">A</span>()
    {
        std::cout &lt;&lt; <span class="hljs-string">"A destory, b_ptr use_count:"</span> &lt;&lt; b_ptr.<span class="hljs-built_in">use_count</span>() &lt;&lt; <span class="hljs-string">"\n"</span>;
    }

    <span class="hljs-comment">// std::shared_ptr&lt;B&gt; b_ptr;//它会造成循环引用</span>
    std::weak_ptr&lt;B&gt; b_ptr;<span class="hljs-comment">//它不会循环引用</span>
};

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-function">std::shared_ptr&lt;A&gt; <span class="hljs-title">a</span><span class="hljs-params">(<span class="hljs-keyword">new</span> A())</span></span>;
    <span class="hljs-function">std::shared_ptr&lt;B&gt; <span class="hljs-title">b</span><span class="hljs-params">(<span class="hljs-keyword">new</span> B())</span></span>;
    a-&gt;b_ptr = b;
    b-&gt;a_ptr = a;

    std::cout &lt;&lt; <span class="hljs-string">"A:"</span> &lt;&lt; a.<span class="hljs-built_in">use_count</span>() &lt;&lt; <span class="hljs-string">"\n"</span>;
    std::cout &lt;&lt; <span class="hljs-string">"B:"</span> &lt;&lt; b.<span class="hljs-built_in">use_count</span>() &lt;&lt; <span class="hljs-string">"\n"</span>;
}
<span class="hljs-comment">// * 运行结果：</span>
<span class="hljs-comment">// A:2</span>
<span class="hljs-comment">// B:2</span></code></pre>
<p>&nbsp;</p>
<h2 id="blogTitle5">如何选择智能指针<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>（1）如果程序要使用多个指向同一个对象的指针，应选择shared_ptr。这样的情况包括：</p>
<ul>
<li>有一个指针数组，并使用一些辅助指针来标示特定的元素，如最大的元素和最小的元素；</li>
<li>两个对象包含都指向第三个对象的指针；</li>
<li>STL容器包含指针。很多STL算法都支持复制和赋值操作，这些操作可用于shared_ptr，但不能用于unique_ptr（编译器发出warning）和auto_ptr（行为不确定）。如果你的编译器没有提供shared_ptr，可使用Boost库提供的shared_ptr。</li>
</ul>
<p>（2）如果程序不需要多个指向同一个对象的指针，则可使用unique_ptr。如果函数使用new分配内存，并返还指向该内存的指针，将其返回类型声明为unique_ptr是不错的选择。这样，所有权转让给接受返回值的unique_ptr，而该智能指针将负责调用delete。可将unique_ptr存储到STL容器在那个，只要不调用将一个unique_ptr复制或赋给另一个算法（如sort()）。例如，可在程序中使用类似于下面的代码段。</p>
<h4>&nbsp; (3) 基于性能考虑：<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h4>
<p style="padding-left: 80px" data-pid="KBzKGqcF">1、unique_ptr独占对象的所有权，由于没有引用计数，因此性能较好</p>
<p style="padding-left: 80px" data-pid="ThoTZDbv">2、shared_ptr共享对象的所有权，但性能略差</p>
<p style="padding-left: 80px" data-pid="2XVph8ZH">3、weak_ptr配合shared_ptr，解决循环引用的问题</p>
<p data-pid="_KQ0j_TC">&nbsp; &nbsp; &nbsp; &nbsp;由于性能问题，那么可以粗暴的理解：优先使用unique_ptr。但由于unique_ptr不能进行复制，因此部分场景下不能使用的。</p>
<p data-pid="_KQ0j_TC">&nbsp;</p>
<h2 id="blogTitle6">智能指针的错误用法<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p data-pid="Tb2cu2q5">1、使用智能指针托管的对象，尽量不要在再使用原生指针</p>
<p data-pid="tl1Iy6bw">很多开发同学（包括我在内）在最开始使用智能指针的时候，对同一个对象会混用智能指针和原生指针，导致程序异常。</p>
<div class="highlight">
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">incorrect_smart_pointer1</span><span class="hljs-params">()</span>
</span>{
    A *a= <span class="hljs-keyword">new</span> <span class="hljs-built_in">A</span>();
    <span class="hljs-function">std::unique_ptr&lt;A&gt; <span class="hljs-title">unique_ptr_a</span><span class="hljs-params">(a)</span></span>;

    <span class="hljs-comment">// 此处将导致对象的二次释放</span>
    <span class="hljs-keyword">delete</span> a;
}</code></pre>
</div>
<p data-pid="zBa3ey9V">2、不要把一个原生指针交给多个智能指针管理</p>
<p data-pid="VN4A8u8R">如果将一个原生指针交个多个智能指针，这些智能指针释放对象时会产生对象的多次销毁</p>
<div class="highlight">
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">incorrect_smart_pointer2</span><span class="hljs-params">()</span>
</span>{
    A *a= <span class="hljs-keyword">new</span> <span class="hljs-built_in">A</span>();
    <span class="hljs-function">std::unique_ptr&lt;A&gt; <span class="hljs-title">unique_ptr_a1</span><span class="hljs-params">(a)</span></span>;
    <span class="hljs-function">std::unique_ptr&lt;A&gt; <span class="hljs-title">unique_ptr_a2</span><span class="hljs-params">(a)</span></span>;<span class="hljs-comment">// 此处将导致对象的二次释放</span>
}</code></pre>
</div>
<p data-pid="QsomhVjP">3、尽量不要使用 get()获取原生指针</p>
<div class="highlight">
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">incorrect_smart_pointer3</span><span class="hljs-params">()</span>
</span>{
    std::shared_ptr&lt;A&gt; shared_ptr_a1 = std::<span class="hljs-built_in">make_shared</span>&lt;A&gt;();

    A *a= shared_ptr_a1.<span class="hljs-built_in">get</span>();

    <span class="hljs-function">std::shared_ptr&lt;A&gt; <span class="hljs-title">shared_ptr_a2</span><span class="hljs-params">(a)</span></span>;<span class="hljs-comment">// 此处将导致对象的二次释放</span>

    <span class="hljs-keyword">delete</span> a;<span class="hljs-comment">// 此处也将导致对象的二次释放</span>
}</code></pre>
</div>
<p data-pid="Femj9eFt">4、不要将 this 指针直接托管智能指针</p>
<div class="highlight">
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-keyword">class</span> <span class="hljs-title class_">E</span>
{
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use_this</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">//错误方式，用this指针重新构造shared_ptr，将导致二次释放当前对象</span>
        <span class="hljs-function">std::shared_ptr&lt;E&gt; <span class="hljs-title">this_shared_ptr1</span><span class="hljs-params">(<span class="hljs-keyword">this</span>)</span></span>;
    }
};

std::shared_ptr&lt;E&gt; e = std::<span class="hljs-built_in">make_shared</span>&lt;E&gt;();</code></pre>
</div>
<p data-pid="7kECTiJF">5、智能指针只能管理堆对象，不能管理栈上对象</p>
<p data-pid="JETEOtA3">栈上对象本身在出栈时就会被自动销毁，如果将其指针交给智能指针，会造成对象的二次销毁</p>
<div class="highlight">
<pre class="language-cpp highlighter-hljs" highlighted="true"><code class="highlighter-hljs language-cpp hljs"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">incorrect_smart_pointer5</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-type">int</span> int_num = <span class="hljs-number">3</span>;
    <span class="hljs-function">std::unique_ptr&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">int_unique_ptr</span><span class="hljs-params">(&amp;int_num)</span></span>;
}</code></pre>
</div>
<h2 id="blogTitle7">缺点和优化<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<ol>
<li>
<p><strong>内存占用高</strong><br>shared_ptr 的内存占用是裸指针的两倍。因为除了要管理一个裸指针外，还要维护一个引用计数。<br>因此相比于 unique_ptr, shared_ptr 的内存占用更高。 性能要求高时，可以用裸指针。</p>
</li>
<li>
<p><strong>原子操作性能低</strong><br>考虑到线程安全问题，引用计数的增减必须是原子操作。而原子操作一般情况下都比非原子操作慢。可以引入锁机制，或者用裸指针。</p>
</li>
<li>
<p><strong>使用移动优化性能</strong><br>shared_ptr 在性能上固然是低于 unique_ptr。而通常情况，我们也可以尽量避免 shared_ptr 复制。<br>如果，一个 shared_ptr 需要将所有权共享给另外一个新的 shared_ptr，而我们确定在之后的代码中都不再使用这个 shared_ptr，那么这是一个非常鲜明的移动语义。<br>对于此种场景，我们尽量使用 std::move，将 shared_ptr 转移给新的对象。因为移动不用增加引用计数，性能比复制更好。</p>
</li>
</ol>
<h2 id="blogTitle8">汇总&nbsp;<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>智能指针能更安全的回收内存，它能防止：</p>
<p>  1. 忘记delete造成的内存泄露</p>
<p>  2. delete了，又被访问到了，比如并发时，导致“野指针”的危险情况</p>
<p>  3. delete了，又被delete了，导致重复回收，导致报错中断程序</p>
<p>&nbsp;</p>
<p>总的来说，一般推荐用智能指针，性能要求很高时，可以用裸指针，但要十分小心。</p>
<p>&nbsp;</p>
<h2 id="blogTitle9">参考<button class="cnblogs-toc-button" title="显示目录导航" aria-expanded="false"></button></h2>
<p>https://docs.microsoft.com/zh-cn/cpp/cpp/smart-pointers-modern-cpp?view=msvc-170</p>
<p>https://www.zhihu.com/question/319277442/answer/2384378560</p>
<p>https://www.cyhone.com/articles/right-way-to-use-cpp-smart-pointer/</p>
<p>https://juejin.cn/post/6844904198962675719</p>
<p>&nbsp;</p>
<img width="300" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/o_200525104432281590403276_.pic_hd.jpg" data-action="zoom"></div>
<div id="MySignature" role="contentinfo">
    <p>本文来自博客园，作者：<a href="https://www.cnblogs.com/sunsky303/" target="_blank">sunsky303</a>，转载请注明原文链接：<a href="https://www.cnblogs.com/sunsky303/p/16497592.html" target="_blank">https://www.cnblogs.com/sunsky303/p/16497592.html</a></p>
</div>
<div class="clear"></div>
<div id="blog_post_info_block" role="contentinfo">


    <div id="blog_post_info">
<div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(16497592,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
        <a id="green_channel_follow" onclick="follow(&#39;6bee8a39-b9ba-e111-aa3f-842b2b196315&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/sunsky303/" target="_blank"><img src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/20170329141435.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="https://home.cnblogs.com/u/sunsky303/">sunsky303</a><br>
            <a href="https://home.cnblogs.com/u/sunsky303/followers/">粉丝 - <span class="follower-count">132</span></a>
            <a href="https://home.cnblogs.com/u/sunsky303/followees/">关注 - <span class="following-count">7</span></a><br>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow" class="follow-tip">
                <a href="javascript:void(0);" onclick="follow(&#39;6bee8a39-b9ba-e111-aa3f-842b2b196315&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(16497592,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">0</span>
    </div>
    <div class="buryit" onclick="votePost(16497592,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>

<script type="text/javascript">
    currentDiggType = 0;
</script></div>
    <div class="clear"></div>
    <div id="post_next_prev">

    <a href="https://www.cnblogs.com/sunsky303/p/16479110.html" class="p_n_p_prefix">« </a> 上一篇：    <a href="https://www.cnblogs.com/sunsky303/p/16479110.html" data-featured-image="" title="发布于 2022-07-14 19:54">万能Debug神器之GDB的使用手册</a>
    <br>
    <a href="https://www.cnblogs.com/sunsky303/p/16519755.html" class="p_n_p_prefix">» </a> 下一篇：    <a href="https://www.cnblogs.com/sunsky303/p/16519755.html" data-featured-image="" title="发布于 2022-07-26 09:46">Trzsz 文件传输利器</a>

</div>
</div>
            </div>
            <div class="postDesc">posted @ 
<span id="post-date">2022-07-20 14:24</span>&nbsp;
<a href="https://www.cnblogs.com/sunsky303/">sunsky303</a>&nbsp;
阅读(<span id="post_view_count">566</span>)&nbsp;
评论(<span id="post_comment_count">0</span>)&nbsp;
<a href="https://i.cnblogs.com/EditPosts.aspx?postid=16497592" rel="nofollow">编辑</a>&nbsp;
<a href="javascript:void(0)" onclick="AddToWz(16497592);return false;">收藏</a>&nbsp;
<a href="javascript:void(0)" onclick="reportManager.report({ currentUserId: &#39;&#39;, targetType: &#39;blogPost&#39;, targetId: &#39;16497592&#39;, targetLink: &#39;https://www.cnblogs.com/sunsky303/p/16497592.html&#39;, title: &#39;彻底搞懂之C++智能指针&#39; })">举报</a></div>
        </div>
	    
	    
    </div><!--end: topics 文章、评论容器-->
</div>

<script>
    var cb_entryId = 16497592, cb_entryCreatedDate = '2022-07-20 14:24', cb_postType = 1, cb_postTitle = '彻底搞懂之C++智能指针';
    var allowComments = true, cb_blogId = 120626, cb_blogApp = 'sunsky303', cb_blogUserGuid = '6bee8a39-b9ba-e111-aa3f-842b2b196315';
    mermaidRender.render()
    markdown_highlight()
    zoomManager.apply("#cnblogs_post_body img:not(.code_img_closed):not(.code_img_opened)");
    updatePostStats(
            [cb_entryId],
            function(id, count) { $("#post_view_count").text(count) },
            function(id, count) { $("#post_comment_count").text(count) })
</script>
<a id="!comments"></a>
<div id="blog-comments-placeholder"></div>
<div id="comment_form" class="commentform">
    <a name="commentform"></a>
    <div id="divCommentShow"></div>
    <div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="https://www.cnblogs.com/sunsky303/p/16497592.html#" onclick="return RefreshPage();">刷新页面</a><a href="https://www.cnblogs.com/sunsky303/p/16497592.html#top">返回顶部</a></div>
    <div id="comment_form_container" style="visibility: visible;"><div class="login_tips">
    登录后才能查看或发表评论，立即 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return account.login(&#39;!comments&#39;);">登录</a> 或者
    <a href="https://www.cnblogs.com/">逛逛</a> 博客园首页
</div>
</div>
    <div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
        <div id="cnblogs_ch"><a href="https://www.cnblogs.com/MASA/p/16543600.html" target="_blank" onclick="gtag(&#39;event&#39;, &#39;click&#39;, {&#39;event_category&#39;: &#39;ad&#39;, &#39;event_label&#39;: &#39;T2-MASA&#39;})">【推荐】MASA Framework 开启全新的.NET应用开发体验</a><br><a href="https://brands.cnblogs.com/specdd" target="_blank" onclick="gtag(&#39;event&#39;, &#39;click&#39;, {&#39;event_category&#39;: &#39;ad&#39;, &#39;event_label&#39;: &#39;T2-SpecDD专区&#39;})">【推荐】下一步，敏捷！云可达科技SpecDD敏捷开发专区</a><br><a href="https://curl.qcloud.com/k19RDMHo" target="_blank" onclick="gtag(&#39;event&#39;, &#39;click&#39;, {&#39;event_category&#39;: &#39;ad&#39;, &#39;event_label&#39;: &#39;T2-腾讯云&#39;})">【推荐】腾讯云多款云产品1折起，买云服务器送免费机器</a><br></div>
    <div id="opt_under_post"></div>
    <div id="cnblogs_c1" class="under-post-card" style="display: none;">
            <div id="div-gpt-ad-1592365906576-0" style="width: 300px; height: 250px; display: none;" data-google-query-id="CPLuktKM3PkCFQtevQodvcIN7w"><div id="google_ads_iframe_/1090369/C1_0__container__" style="border: 0pt none; width: 300px; height: 0px;"></div></div>
    </div>
    <div id="under_post_card1"><div class="under-post-card">
<b>编辑推荐：</b>
<br>

· <a href="https://www.cnblogs.com/artech/p/inside-asp-net-core-6-33x.html" target="_blank">ASP.NET Core 6 框架揭秘实例演示：异常处理高阶用法</a>
    <br>
· <a href="https://www.cnblogs.com/Chang-LeHung/p/16599776.html" target="_blank">彻底了解线程池的原理——40行从零开始自己写线程池</a>
    <br>
· <a href="https://www.cnblogs.com/lesliexin/p/16588060.html" target="_blank">[MAUI]在窗口（页面）关闭后获取其返回值</a>
    <br>
· <a href="https://www.cnblogs.com/SunSpring/p/16601339.html" target="_blank">.net 温故知新：IOC控制反转，DI依赖注入</a>
    <br>
· <a href="https://www.cnblogs.com/wzh2010/p/15730040.html" target="_blank">架构与思维：互联网高性能 Web 架构</a>
    <br>
</div></div>
    <div id="under_post_card2"><div class="itnews under-post-card">
    <b>最新新闻</b>：
    <br>
 ·          <a href="https://news.cnblogs.com/n/726996/" target="_blank">我国首次出口的高铁列车正式启运</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/726995/" target="_blank">苹果Find My化身社交工具</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/726994/" target="_blank">浙大发布「数据混合增强」框架AutoMix，还顺手开源了众多mixup算法</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/726993/" target="_blank">Adobe突然查封中国账号，设计社区Behance无权访问！</a>
        <br>
 ·          <a href="https://news.cnblogs.com/n/726992/" target="_blank">2022丘成桐数学竞赛放榜！清华3金10银霸榜</a>
        <br>
    » <a href="https://news.cnblogs.com/" title="IT 新闻" target="_blank">更多新闻...</a>
</div></div>
    <div id="HistoryToday" class="under-post-card"></div>
    <script type="text/javascript">
        var commentManager = new blogCommentManager();
        commentManager.renderComments(0);
        fixPostBody();

            window.tocManager.displayDisableTocTips = false;
            window.tocManager.generateToc();
            
                setTimeout(function() { countViews(cb_blogId, cb_entryId); }, 50);
            
            deliverT2();
            deliverC1C2();
            loadNewsAndKb();
            
                LoadPostCategoriesTags(cb_blogId, cb_entryId);
            
            LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
            GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate, cb_postType);
            loadOptUnderPost();
            GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);
                </script>
</div>

	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->
	<div id="sideBar">
		<div id="sideBarMain">
			<div id="sidebar_news" class="newsItem" style="display: block;"><!--done-->
<h3 class="catListTitle">公告</h3>

<div id="blog-news">
    
    <div id="profile_block">
        昵称：
        <a href="https://home.cnblogs.com/u/sunsky303/">
            sunsky303
        </a>
        <br>
        园龄：
        <a href="https://home.cnblogs.com/u/sunsky303/" title="入园时间：2012-06-20">
            10年2个月
        </a>
        <br>
        粉丝：
        <a class="follower-count" href="https://home.cnblogs.com/u/sunsky303/followers/">
            132
        </a>
        <br>
        关注：
        <a class="folowing-count" href="https://home.cnblogs.com/u/sunsky303/followees/">
            7
        </a>
        <div id="p_b_follow" class="follow-tip">
<a href="javascript:void(0)" onclick="follow(&#39;6bee8a39-b9ba-e111-aa3f-842b2b196315&#39;)">+加关注</a></div>
        <script>getFollowStatus('6bee8a39-b9ba-e111-aa3f-842b2b196315');</script>
    </div>
</div>

</div>
<div id="sidebar_c3"></div>
			<div id="blog-calendar" style="display: block;">

<table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar" border="0">
    <tbody>
        <tr>
            <td colspan="7">
                <table class="CalTitle" cellspacing="0" border="0">
                    <tbody>
                        <tr>
                            <td class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2022/07/23&#39;); return false;">&lt;</a>
                            </td>
                            <td align="center">2022年8月</td>
                            <td align="right" class="CalNextPrev">
                                <a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2022/09/23&#39;); return false;">&gt;</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </td>
        </tr>
    <tr>
        <th class="CalDayHeader" align="center" abbr="日" scope="col">日</th>
        <th class="CalDayHeader" align="center" abbr="一" scope="col">一</th>
        <th class="CalDayHeader" align="center" abbr="二" scope="col">二</th>
        <th class="CalDayHeader" align="center" abbr="三" scope="col">三</th>
        <th class="CalDayHeader" align="center" abbr="四" scope="col">四</th>
        <th class="CalDayHeader" align="center" abbr="五" scope="col">五</th>
        <th class="CalDayHeader" align="center" abbr="六" scope="col">六</th>
    </tr>
            <tr>
                            <td class="CalOtherMonthDay" align="center">31</td>
                        <td class="" align="center">
                            <a href="https://www.cnblogs.com/sunsky303/archive/2022/08/01.html"><u>1</u></a>
                        </td>
                        <td class="" align="center">
                            2
                        </td>
                        <td class="" align="center">
                            3
                        </td>
                        <td class="" align="center">
                            4
                        </td>
                        <td class="" align="center">
                            5
                        </td>
                    <td class="CalWeekendDay" align="center">
                        6
                    </td>
            </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            7
                        </td>
                            <td class="" align="center">
                                8
                            </td>
                            <td class="" align="center">
                                9
                            </td>
                            <td class="" align="center">
                                10
                            </td>
                            <td class="" align="center">
                                11
                            </td>
                            <td class="" align="center">
                                12
                            </td>
                        <td class="CalWeekendDay" align="center">
                            13
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            14
                        </td>
                            <td class="" align="center">
                                15
                            </td>
                            <td class="" align="center">
                                16
                            </td>
                            <td class="" align="center">
                                17
                            </td>
                            <td class="" align="center">
                                18
                            </td>
                            <td class="" align="center">
                                19
                            </td>
                        <td class="CalWeekendDay" align="center">
                            20
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            21
                        </td>
                            <td class="" align="center">
                                22
                            </td>
                            <td class="CalTodayDay" align="center">
                                23
                            </td>
                            <td class="" align="center">
                                24
                            </td>
                            <td class="" align="center">
                                25
                            </td>
                            <td class="" align="center">
                                26
                            </td>
                        <td class="CalWeekendDay" align="center">
                            27
                        </td>
                </tr>
                <tr>
                        <td class="CalWeekendDay" align="center">
                            28
                        </td>
                            <td class="" align="center">
                                29
                            </td>
                            <td class="" align="center">
                                30
                            </td>
                            <td class="" align="center">
                                31
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                1
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                2
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            3
                        </td>
                </tr>
                <tr>
                        <td class="CalOtherMonthDay" align="center">
                            4
                        </td>
                            <td class="CalOtherMonthDay" align="center">
                                5
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                6
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                7
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                8
                            </td>
                            <td class="CalOtherMonthDay" align="center">
                                9
                            </td>
                        <td class="CalOtherMonthDay" align="center">
                            10
                        </td>
                </tr>
    </tbody>
</table></div><script>loadBlogDefaultCalendar();</script>			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><!-- 搜索 -->
<div id="sidebar_search" class="sidebar-block">
    <div id="sidebar_search" class="mySearch">
        <h3 class="catListTitle">搜索</h3>
        <div id="sidebar_search_box">
            <div id="widget_my_zzk" class="div_my_zzk">
                <input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk">
            </div>
            <div id="widget_my_google" class="div_my_zzk">
                <input type="text" name="google_q" id="google_q" onkeydown="return google_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="google_go()" type="button" value="谷歌搜索" class="btn_my_zzk">
            </div>
        </div>
    </div>
</div>

<!-- 常用链接 -->
<div id="sidebar_shortcut" class="sidebar-block"><div class="catListLink">
<h3 class="catListTitle">
常用链接
</h3>
<ul>
    <li><a href="https://www.cnblogs.com/sunsky303/p/" title="我的博客的随笔列表">我的随笔</a></li>
<li><a href="https://www.cnblogs.com/sunsky303/MyComments.html" title="我的发表过的评论列表">我的评论</a></li>
<li><a href="https://www.cnblogs.com/sunsky303/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li>
<li><a href="https://www.cnblogs.com/sunsky303/comments" title="我的博客的评论列表">最新评论</a></li>
<li><a href="https://www.cnblogs.com/sunsky303/tag/" title="我的博客的标签列表">我的标签</a></li>

</ul>
</div>

</div>

<!-- 最新随笔 -->
<div id="sidebar_recentposts" class="sidebar-block"><div class="catListEssay">
<h3 class="catListTitle">最新随笔</h3>
    <ul>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16541676.html">1.Go高性能之方法接收器 - 指针vs值</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16519755.html">2.Trzsz 文件传输利器</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16497592.html">3.彻底搞懂之C++智能指针</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16479110.html">4.万能Debug神器之GDB的使用手册</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16468234.html">5.一种快速判断点在多边形内的算法</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16467684.html">6.理解点线拓扑关系的计算原理</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16437766.html">7.JSON神器之jq使用指南指北</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16437041.html">8.SSH(sshd)终极安全加固指南</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16399236.html">9.10 种CORS跨域解决方案</a>

                </li>
                <li>
                    
<a href="https://www.cnblogs.com/sunsky303/p/16389011.html">10.centos问题解决方案汇总</a>

                </li>
    </ul>
</div>

</div>

<!-- 我的标签 -->
<div id="sidebar_toptags" class="sidebar-block"><div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/2017/">2017<span class="tag-count">(2)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/NoSQL/">NoSQL<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/HBase/">HBase<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/%E5%B0%91%E7%94%A8%5B%5D/">少用[]<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/%E3%80%90%E4%B8%80%E9%80%9A%E7%99%BE%E9%80%9A%E3%80%91Bash%E7%9A%84%E5%8D%95%E5%8F%8C%E6%8B%AC%E5%8F%B7%E5%BB%BA%E8%AE%AE%EF%BC%9A%E5%A4%9A%E7%94%A8%5B%5B%5D%5D/">【一通百通】Bash的单双括号建议：多用[[]]<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/%E3%80%90%E4%B8%80%E9%80%9A%E7%99%BE%E9%80%9A%E3%80%91C%2FC%2B%2B%E7%9A%84std%E6%A0%87%E5%87%86%E6%80%BB%E7%BB%93/">【一通百通】C/C++的std标准总结<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/%E3%80%90%E4%B8%80%E9%80%9A%E7%99%BE%E9%80%9A%E3%80%91c%2Fphp%E7%9A%84printf%E6%80%BB%E7%BB%93/">【一通百通】c/php的printf总结<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/%E7%A6%BB%E5%BC%80%20Mac%20%20%20Windows%20%E8%8B%B9%E6%9E%9C%20%E6%94%BE%E5%BC%83/">离开 Mac   Windows 苹果 放弃<span class="tag-count">(1)</span></a>
        </li>
        <li>
            <a href="https://www.cnblogs.com/sunsky303/tag/2017%E5%B9%B4%20golang%E3%80%81python%E3%80%81php%E3%80%81c%2B%2B%E3%80%81c%E3%80%81java%E3%80%81Nodejs%20%E6%80%A7%E8%83%BD%20%E5%AF%B9%E6%AF%94/">2017年 golang、python、php、c++、c、java、Nodejs 性能 对比<span class="tag-count">(1)</span></a>
        </li>
    <li>
        <a href="https://www.cnblogs.com/sunsky303/tag/">更多</a>
    </li>

</ul>
</div>

</div>

<!-- 积分与排名 -->
<div id="sidebar_scorerank" class="sidebar-block"><div class="catListBlogRank">
<h3 class="catListTitle">积分与排名</h3>
<ul>
	<li class="liScore">
		积分 -	
649782
	</li>
	<li class="liRank">
		排名 -	
688
	</li>
</ul>
</div>



</div>

<!-- 随笔分类、随笔档案、文章分类、新闻分类、相册、链接 -->
<div id="sidebar_categories">

    <div id="sidebar_postcategory" class="catListPostCategory sidebar-block">
        <h3 class="catListTitle">
            
    <a class="sidebar-card-title-a" href="https://www.cnblogs.com/sunsky303/categories">随笔分类</a>
<span class="sidebar-category-item-count">
    (9)
</span>


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/category/2045214.html" class="category-item-link" rel="" target="">代码(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/category/1478616.html" class="category-item-link" rel="" target="">吉他(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/category/1478620.html" class="category-item-link" rel="" target="">架构(3)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/category/1478619.html" class="category-item-link" rel="" target="">系统基础(4)</a>
 
                </li>                
            
        </ul>


    </div>    
    <div id="sidebar_postarchive" class="catListPostArchive sidebar-block">
        <h3 class="catListTitle">
            
随笔档案<span class="sidebar-category-item-count">
    (452)
</span>


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2022/08.html" class="category-item-link" rel="" target="">2022年8月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2022/07.html" class="category-item-link" rel="" target="">2022年7月(7)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2022/06.html" class="category-item-link" rel="" target="">2022年6月(4)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2022/05.html" class="category-item-link" rel="" target="">2022年5月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2021/10.html" class="category-item-link" rel="" target="">2021年10月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2021/06.html" class="category-item-link" rel="" target="">2021年6月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2021/02.html" class="category-item-link" rel="" target="">2021年2月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2021/01.html" class="category-item-link" rel="" target="">2021年1月(6)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/12.html" class="category-item-link" rel="" target="">2020年12月(7)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/11.html" class="category-item-link" rel="" target="">2020年11月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/10.html" class="category-item-link" rel="" target="">2020年10月(9)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/09.html" class="category-item-link" rel="" target="">2020年9月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/08.html" class="category-item-link" rel="" target="">2020年8月(8)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/07.html" class="category-item-link" rel="" target="">2020年7月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/06.html" class="category-item-link" rel="" target="">2020年6月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/05.html" class="category-item-link" rel="" target="">2020年5月(6)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/04.html" class="category-item-link" rel="" target="">2020年4月(3)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/03.html" class="category-item-link" rel="" target="">2020年3月(4)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/02.html" class="category-item-link" rel="" target="">2020年2月(4)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2020/01.html" class="category-item-link" rel="" target="">2020年1月(4)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/12.html" class="category-item-link" rel="" target="">2019年12月(7)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/11.html" class="category-item-link" rel="" target="">2019年11月(14)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/10.html" class="category-item-link" rel="" target="">2019年10月(19)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/09.html" class="category-item-link" rel="" target="">2019年9月(29)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/08.html" class="category-item-link" rel="" target="">2019年8月(7)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/07.html" class="category-item-link" rel="" target="">2019年7月(31)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/06.html" class="category-item-link" rel="" target="">2019年6月(37)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/05.html" class="category-item-link" rel="" target="">2019年5月(5)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/04.html" class="category-item-link" rel="" target="">2019年4月(14)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/03.html" class="category-item-link" rel="" target="">2019年3月(7)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2019/02.html" class="category-item-link" rel="" target="">2019年2月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/12.html" class="category-item-link" rel="" target="">2018年12月(3)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/11.html" class="category-item-link" rel="" target="">2018年11月(3)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/10.html" class="category-item-link" rel="" target="">2018年10月(8)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/09.html" class="category-item-link" rel="" target="">2018年9月(17)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/08.html" class="category-item-link" rel="" target="">2018年8月(22)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/07.html" class="category-item-link" rel="" target="">2018年7月(12)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/06.html" class="category-item-link" rel="" target="">2018年6月(23)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/05.html" class="category-item-link" rel="" target="">2018年5月(21)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/04.html" class="category-item-link" rel="" target="">2018年4月(12)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/03.html" class="category-item-link" rel="" target="">2018年3月(13)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/02.html" class="category-item-link" rel="" target="">2018年2月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2018/01.html" class="category-item-link" rel="" target="">2018年1月(14)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/12.html" class="category-item-link" rel="" target="">2017年12月(14)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/11.html" class="category-item-link" rel="" target="">2017年11月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/10.html" class="category-item-link" rel="" target="">2017年10月(6)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/09.html" class="category-item-link" rel="" target="">2017年9月(4)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/08.html" class="category-item-link" rel="" target="">2017年8月(5)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/06.html" class="category-item-link" rel="" target="">2017年6月(3)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/05.html" class="category-item-link" rel="" target="">2017年5月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/03.html" class="category-item-link" rel="" target="">2017年3月(8)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2017/02.html" class="category-item-link" rel="" target="">2017年2月(3)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2013/12.html" class="category-item-link" rel="" target="">2013年12月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2013/09.html" class="category-item-link" rel="" target="">2013年9月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2013/08.html" class="category-item-link" rel="" target="">2013年8月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2013/01.html" class="category-item-link" rel="" target="">2013年1月(2)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2011/06.html" class="category-item-link" rel="" target="">2011年6月(1)</a>
 
                </li>                
                <li data-category-list-item-visible="false" style="display: none">
                    
<a href="https://www.cnblogs.com/sunsky303/archive/2011/03.html" class="category-item-link" rel="" target="">2011年3月(3)</a>
 
                </li>                
            <li>
                <a href="javascript:void(0)" onclick="sideColumnManager.loadMore(this)">更多</a>
            </li>
        </ul>


    </div>    
    <div id="sidebar_articlearchive" class="catListArticleArchive sidebar-block">
        <h3 class="catListTitle">
            
文章档案<span class="sidebar-category-item-count">
    (1)
</span>


        </h3>

        <ul>

                <li data-category-list-item-visible="true" style="display: block">
                    
<a href="https://www.cnblogs.com/sunsky303/archives/2017/03.html" class="category-item-link" rel="nofollow noopener noreferrer" target="">2017年3月(1)</a>
 
                </li>                
            
        </ul>


    </div>    
</div>

<!-- 最新评论 -->
<!-- 阅读排行榜 -->
<div id="sidebar_topviewedposts" class="sidebar-block"><div class="catListView">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/sunsky303/most-viewed" class="sidebar-card-title-a">
    阅读排行榜
</a>

    </h3>
    <div id="TopViewPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/9438737.html">
                            1. Elasticsearch入门，这一篇就够了(156512)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/8274586.html">
                            2. mysql各种引擎对比、实战(95137)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/8862128.html">
                            3. 浏览器同域名请求的最大并发数限制(61905)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/9209024.html">
                            4. consul配置参数大全、详解、总结(53213)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/9238669.html">
                            5. dnsmasq详解&amp;手册(51771)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 评论排行榜 -->
<div id="sidebar_topcommentedposts" class="sidebar-block"><div class="catListFeedback">
    <h3 class="catListTitle">
        <a href="https://www.cnblogs.com/sunsky303/most-commented" class="sidebar-card-title-a">评论排行榜</a>

    </h3>
    <div id="TopFeedbackPostsBlock">
        <ul style="word-break:break-all">
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/6506663.html">
                            1. 2017年的golang、python、php、c++、c、java、Nodejs性能对比（golang  python  php c++ java Nodejs Performance）(18)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/9438737.html">
                            2. Elasticsearch入门，这一篇就够了(7)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/8962628.html">
                            3. 网络IO和磁盘IO详解(6)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/11121409.html">
                            4. 优雅的重启服务(4)
                        </a>
                    </li>
                    <li>
                        <a href="https://www.cnblogs.com/sunsky303/p/9296188.html">
                            5. Go代码重构：23倍的性能爆增(4)
                        </a>
                    </li>
        </ul>
    </div>
</div></div>

<!-- 推荐排行榜 -->
<div id="sidebar_topdiggedposts" class="sidebar-block">
<div id="topdigg_posts_wrap">
    <div class="catListView">
        <h3 class="catListTitle">
            <a href="https://www.cnblogs.com/sunsky303/most-liked" class="sidebar-card-title-a">推荐排行榜</a>

        </h3>
        <div id="TopDiggPostsBlock">
            <ul style="word-break: break-all">
                        <li>
                            <a href="https://www.cnblogs.com/sunsky303/p/9438737.html">
                                1. Elasticsearch入门，这一篇就够了(16)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/sunsky303/p/8962628.html">
                                2. 网络IO和磁盘IO详解(12)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/sunsky303/p/8274586.html">
                                3. mysql各种引擎对比、实战(9)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/sunsky303/p/9705727.html">
                                4. 深入Golang调度器之GMP模型(7)
                            </a>
                        </li>
                        <li>
                            <a href="https://www.cnblogs.com/sunsky303/p/10775126.html">
                                5. 图文详解k8s自动化持续集成之GitLab CI/CD(6)
                            </a>
                        </li>
            </ul>
        </div>
    </div>
</div></div><div id="sidebar_recentcomments" class="sidebar-block"><div class="catListComment">
<h3 class="catListTitle"><a href="https://www.cnblogs.com/sunsky303/comments" class="sidebar-card-title-a">最新评论</a></h3>
    <div class="RecentCommentBlock">
        <ul>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/sunsky303/p/9438737.html">1. Re:Elasticsearch入门，这一篇就够了</a></li>
                <li class="recent_comment_body"><p>内容不错, 这个排版. 真的丑,看着还难受</p>
</li>
                <li class="recent_comment_author">--所谓不执着</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/sunsky303/p/11819055.html">2. Re:Go语言中初始化变量中字面量&amp;Type{}、new、make的区别</a></li>
                <li class="recent_comment_body"><p>对的</p>
</li>
                <li class="recent_comment_author">--sunsky303</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/sunsky303/p/7731911.html">3. Re:Linux共享库、静态库、动态库详解</a></li>
                <li class="recent_comment_body"><p>顶一下。不过哈，哎呀，不够精简</p>
</li>
                <li class="recent_comment_author">--时间的风景</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/sunsky303/p/13957746.html">4. Re:MYSQL MVCC实现原理详解</a></li>
                <li class="recent_comment_body"><p>好文</p>
</li>
                <li class="recent_comment_author">--rig无悔</li>
                <li class="recent_comment_title"><a href="https://www.cnblogs.com/sunsky303/p/11819055.html">5. Re:Go语言中初始化变量中字面量&amp;Type{}、new、make的区别</a></li>
                <li class="recent_comment_body"><p>mapHeader := map[string]string，末尾加大括号就不用make了</p>
</li>
                <li class="recent_comment_author">--maxweii</li>
        </ul>
    </div>
</div>

</div>


</div>
                    <script>loadBlogSideColumn();</script>
			</div>			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		<!--done-->
Copyright © 2022 sunsky303
<br><span id="poweredby">Powered by .NET 6 on Kubernetes</span>



	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->



<div id="page_end_html">
<script type="text/javascript">
var BlogDirectory = {
    /*
        获取元素位置，距浏览器左边界的距离（left）和距浏览器上边界的距离（top）
    */
    getElementPosition:function (ele) {        
        var topPosition = 0;
        var leftPosition = 0;
        while (ele){              
            topPosition += ele.offsetTop;
            leftPosition += ele.offsetLeft;        
            ele = ele.offsetParent;     
        }  
        return {top:topPosition, left:leftPosition}; 
    },

    /*
    获取滚动条当前位置
    */
    getScrollBarPosition:function () {
        var scrollBarPosition = document.body.scrollTop || document.documentElement.scrollTop;
        return  scrollBarPosition;
    },
    
    /*
    移动滚动条，finalPos 为目的位置，internal 为移动速度
    */
    moveScrollBar:function(finalpos, interval) {

        //若不支持此方法，则退出
        if(!window.scrollTo) {
            return false;
        }

        //窗体滚动时，禁用鼠标滚轮
        window.onmousewheel = function(){
            return false;
        };
          
        //清除计时
        if (document.body.movement) { 
            clearTimeout(document.body.movement); 
        } 

        var currentpos =BlogDirectory.getScrollBarPosition();//获取滚动条当前位置

        var dist = 0; 
        if (currentpos == finalpos) {//到达预定位置，则解禁鼠标滚轮，并退出
            window.onmousewheel = function(){
                return true;
            }
            return true; 
        } 
        if (currentpos < finalpos) {//未到达，则计算下一步所要移动的距离
            dist = Math.ceil((finalpos - currentpos)/10); 
            currentpos += dist; 
        } 
        if (currentpos > finalpos) { 
            dist = Math.ceil((currentpos - finalpos)/10); 
            currentpos -= dist; 
        }
        
        var scrTop = BlogDirectory.getScrollBarPosition();//获取滚动条当前位置
        window.scrollTo(0, currentpos);//移动窗口
        if(BlogDirectory.getScrollBarPosition() == scrTop)//若已到底部，则解禁鼠标滚轮，并退出
        {
            window.onmousewheel = function(){
                return true;
            }
            return true;
        }
        
        //进行下一步移动
        var repeat = "BlogDirectory.moveScrollBar(" + finalpos + "," + interval + ")"; 
        document.body.movement = setTimeout(repeat, interval); 
    },
    
    htmlDecode:function (text){
        var temp = document.createElement("div");
        temp.innerHTML = text;
        var output = temp.innerText || temp.textContent;
        temp = null;
        return output;
    },

    /*
    创建博客目录，
    id表示包含博文正文的 div 容器的 id，
    mt 和 st 分别表示主标题和次级标题的标签名称（如 H2、H3，大写或小写都可以！），
    interval 表示移动的速度
    */
    createBlogDirectory:function (id, mt, st, interval){
         //获取博文正文div容器
        var elem = document.getElementById(id);
        if(!elem) return false;
        //获取div中所有元素结点
        var nodes = elem.getElementsByTagName("*");
        //创建博客目录的div容器
        var divSideBar = document.createElement('DIV');
        divSideBar.className = 'uprightsideBar';
        divSideBar.setAttribute('id', 'uprightsideBar');
        var divSideBarTab = document.createElement('DIV');
        divSideBarTab.setAttribute('id', 'sideBarTab');
        divSideBar.appendChild(divSideBarTab);
        var h2 = document.createElement('H2');
        divSideBarTab.appendChild(h2);
        var txt = document.createTextNode('目录');
        h2.appendChild(txt);
        var divSideBarContents = document.createElement('DIV');
        divSideBarContents.style.display = 'none';
        divSideBarContents.setAttribute('id', 'sideBarContents');
        divSideBar.appendChild(divSideBarContents);
        //创建自定义列表
        var dlist = document.createElement("dl");
        divSideBarContents.appendChild(dlist);
        var num = 0;//统计找到的mt和st
        mt = mt.toUpperCase();//转化成大写
        st = st.toUpperCase();//转化成大写
        //遍历所有元素结点
        for(var i=0; i<nodes.length; i++)
        {
            if(nodes[i].nodeName == mt|| nodes[i].nodeName == st)    
            {
                //获取标题文本
                var nodetext = nodes[i].innerHTML.replace(/<\/?[^>]+>/g,"");//innerHTML里面的内容可能有HTML标签，所以用正则表达式去除HTML的标签
                //nodetext = nodetext.replace(/ /ig, "");//替换掉所有的 
                nodetext = BlogDirectory.htmlDecode(nodetext);
                //插入锚        
                nodes[i].setAttribute("id", "blogTitle" + num);
                var item;
                switch(nodes[i].nodeName)
                {
                    case mt:    //若为主标题 
                        item = document.createElement("dt");
                        break;
                    case st:    //若为子标题
                        item = document.createElement("dd");
                        break;
                }
                
                //创建锚链接
                var itemtext = document.createTextNode(nodetext);
                item.appendChild(itemtext);
                item.setAttribute("name", num);
                item.onclick = function(){        //添加鼠标点击触发函数
                    var pos = BlogDirectory.getElementPosition(document.getElementById("blogTitle" + this.getAttribute("name")));
                    if(!BlogDirectory.moveScrollBar(pos.top, interval)) return false;
                };            
                
                //将自定义表项加入自定义列表中
                dlist.appendChild(item);
                num++;
            }
        }
        
        if(num == 0) return false; 
        /*鼠标进入时的事件处理*/
        divSideBarTab.onmouseenter = function(){
            divSideBarContents.style.display = 'block';
        }
        /*鼠标离开时的事件处理*/
        divSideBar.onmouseleave = function() {
            divSideBarContents.style.display = 'none';
        }

        document.body.appendChild(divSideBar);
    }
    
};

//window.onload=function(){
    /*页面加载完成之后生成博客目录*/
   if(document.querySelector('#cnblogs_post_body h1') != null) 
       BlogDirectory.createBlogDirectory("cnblogs_post_body","h1","h2",20);
   else if(document.querySelector('#cnblogs_post_body h2') != null) 
      BlogDirectory.createBlogDirectory("cnblogs_post_body","h2","h3",20);
  else if(document.querySelector('#cnblogs_post_body h3') != null) 
       BlogDirectory.createBlogDirectory("cnblogs_post_body","h3","h4",20);
//}
</script>

<script>
//用户头像
function customTimer(inpId, fn) {
    if ($(inpId).length) {
        fn();
    } else {
        var intervalId = setInterval(function() {
            if ($(inpId).length) { //如果存在了
                clearInterval(intervalId); // 则关闭定时器
                customTimer(inpId, fn); //执行自身
            }
        }, 100);
    }
}
//添加 评论区的 形象照
function addImage() {
    var spen_html = "<span class='bot' ></span>\
                         <span class='top'></span>";
    $(".blog_comment_body").append(spen_html);

    $(".blog_comment_body").before("<div class='body_right' style='float: left;'><a rel="nofollow noopener"  target='_blank'><img  /></a></div>");
    var feedbackCon = $(".feedbackCon").addClass("clearfix");
    for (var i = 0; i < feedbackCon.length; i++) {
        var span = $(feedbackCon[i]).find("span:last")[0].innerHTML || "//pic.cnblogs.com/face/sample_face.gif";
        $(feedbackCon[i]).find(".body_right img").attr("src", span);
        var href = $(feedbackCon[i]).parent().find(".comment_date").next().attr("href");
        $(feedbackCon[i]).find(".body_right a").attr("href", href);

    }
}

//页面加载完成是执行
$(function() {
    //添加 评论区的 形象照
    customTimer(".blog_comment_body", addImage);

});
</script>
<script type="text/javascript">
(function() {
    var $backToTopTxt = "返回顶部", $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body"))
        .text($backToTopTxt).attr("title", $backToTopTxt).click(function() {
            $("html, body").animate({ scrollTop: 0 }, 120);
    }), $backToTopFun = function() {
        var st = $(document).scrollTop(), winh = $(window).height();
        (st > 0)? $backToTopEle.show(): $backToTopEle.hide();
        //IE6下的定位
        if (!window.XMLHttpRequest) {
            $backToTopEle.css("top", st + winh - 166);
        }
    };
    $(window).bind("scroll", $backToTopFun);
    $(function() { $backToTopFun(); });
})();
</script>

<script>
$('#cnblogs_post_body').append('<img width="300" src="//images.cnblogs.com/cnblogs_com/sunsky303/1477285/o_200525104432281590403276_.pic_hd.jpg"/>');
</script>
<!-- zoom.js 的样式 -->
<link rel="stylesheet" type="text/css" href="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/zoom.css">
<!-- jQuery 的 cdn -->
<script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/jquery-3.5.1.min.js"></script>

<!-- zoom.js 核心代码 -->
<script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/zoom.js"></script>
<script type="text/javascript">$('#cnblogs_post_body img').attr('data-action', 'zoom');</script>
<!-- Bootstrap 的 transition.js cdn（过渡动画插件）-->
<script src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/transition.js"></script>
<!--hidden sidebar-->
<div id="cnblog_sidebar_switcher">显示搜索</div>
<script type="text/javascript">   
    var $sider=document.getElementById("sideBar");
    var $switcher=document.getElementById("cnblog_sidebar_switcher"); 
    var $mainContent=document.getElementById("topics");
  
    $switcher.onclick=function (){
        if($mainContent.style.display=="none"){
        //if($switcher.innerHTML=="显示正文"){
            $switcher.innerHTML="显示搜索";
            $mainContent.style.display="block";
            $sider.style.display="none";
           //$mainContent=document.getElementById("topics");
           //$mainContent.focus();
        }
        else{//displayed main
            $switcher.innerHTML="显示正文";
            $mainContent.style.display="none";
            $sider.style.display="block";
       //var $searcher = document.querySelector("#q.input_my_zzk");
           //$searcher.focus();
        }
    }
</script>

<script type="text/javascript" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/jquery_table_sort.js"></script>
<script>
$(document).ready(function() { 
        $("table").addClass("tablesorter");
        $("table").tablesorter(); 
} ); 
</script>

</div><div class="uprightsideBar" id="uprightsideBar"><div id="sideBarTab"><h2>目录</h2></div><div id="sideBarContents" style="display: none;"><dl><dt name="0">前言</dt><dt name="1">标准库智能指针分类</dt><dt name="2">shared_ptr</dt><dt name="3">unique_ptr</dt><dt name="4">weak_ptr</dt><dt name="5">如何选择智能指针</dt><dt name="6">智能指针的错误用法</dt><dt name="7">缺点和优化</dt><dt name="8">汇总&nbsp;</dt><dt name="9">参考</dt></dl></div></div><div class="backToTop" title="返回顶部" style="display: block;">返回顶部</div>

<input type="hidden" id="antiforgery_token" value="CfDJ8EOBBtWq0dNFoDS-ZHPSe50mD7MyBujFAWLrHwph7-6pkIDgpWqIH4CBo5w_Gno1ishs-WlXfoHfGplZzbWOuED6rN-SHnR6KzKTKeldn4NPUevkWm98E7-ou5oC5DOUrHcbiBdBJ0All_8datyli5g">
<script async="" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/js"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    var kv = getGACustom();
    if (kv) {
        gtag('set', kv);
    }
    gtag('config', 'UA-476124-1');
</script>
<script defer="" src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/hm.js"></script><iframe src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/container.html" style="visibility: hidden; display: none;"></iframe>

<iframe src="./彻底搞懂之C++智能指针 - sunsky303 - 博客园_files/aframe.html" width="0" height="0" style="display: none;"></iframe></body></html>